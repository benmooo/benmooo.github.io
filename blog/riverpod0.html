<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/7833d2e2b2ee9543-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/state_management_migration.jpg"/><link rel="stylesheet" href="/_next/static/css/f30152c0704fba31.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2afc3194b07f38f2.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/a4098ded0e6557f6.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0e4ee5feb628e00d.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-5788873a3947c2cc.js"/><script src="/_next/static/chunks/4bd1b696-18452535c1c4862d.js" async=""></script><script src="/_next/static/chunks/684-a40553b8f97e5ad6.js" async=""></script><script src="/_next/static/chunks/main-app-08d8e87f5b019b96.js" async=""></script><script src="/_next/static/chunks/874-36030fac62063c21.js" async=""></script><script src="/_next/static/chunks/63-5ad18c88ec2f5164.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-ca6c25fdf74e0262.js" async=""></script><meta name="next-size-adjust" content=""/><title>从Provider到Riverpod | 格物致知</title><meta name="description" content="Bulky dependencies declaration VS Automatically managed Sparse dependency injection"/><meta name="keywords" content="Provider迁移,Riverpod优势,Flutter架构"/><meta property="og:title" content="从Provider到Riverpod"/><meta property="og:description" content="Bulky dependencies declaration VS Automatically managed Sparse dependency injection"/><meta property="og:image" content="http://localhost:3000/state_management_migration.jpg"/><meta property="og:image:alt" content="从Provider到Riverpod"/><meta property="og:type" content="article"/><meta property="article:published_time" content="Thu Nov 28 2024 00:00:00 GMT+0000 (Coordinated Universal Time)"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="从Provider到Riverpod"/><meta name="twitter:description" content="Bulky dependencies declaration VS Automatically managed Sparse dependency injection"/><meta name="twitter:image" content="http://localhost:3000/state_management_migration.jpg"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5e6612 __variable_5cfdac __variable_9a8899 antialiased"><div class="min-h-screen bg-background text-foreground"><div class="max-w-2xl mx-auto px-4 py-12"><article><div class="relative w-full h-64 md:h-96 mb-8 rounded-lg overflow-hidden"><img alt="从Provider到Riverpod" decoding="async" data-nimg="fill" class="object-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/state_management_migration.jpg"/></div><header class="mb-12"><div class="flex flex-wrap gap-2 mb-6"><span class="text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg">Flutter</span><span class="text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg">Riverpod</span><span class="text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg">Provider</span></div><h1 class="text-2xl md:text-4xl text-gray-900 dark:text-gray-100 mb-6 leading-tight">从Provider到Riverpod</h1><p class="font-light text-md text-gray-600 dark:text-gray-400 leading-relaxed mb-6 italic">Bulky dependencies declaration VS Automatically managed Sparse dependency injection</p><div class="flex items-center text-sm text-gray-500 dark:text-gray-500"><time dateTime="Thu Nov 28 2024 00:00:00 GMT+0000 (Coordinated Universal Time)">2024年11月28日</time></div><div class="w-16 h-px bg-gray-300 dark:bg-gray-600 mt-8"></div></header><article class="max-w-none prose prose-pink prose-img:rounded-lg prose-video:rounded-lg dark:prose-invert prose-a:text-foreground prose-a:decoration-6 prose-a:-underline-offset-2 prose-a:decoration-pink-300"><h3>缘起：当Provider成为瓶颈</h3>
<h4>1. 手工依赖地狱</h4>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#768390">// 订单模块的依赖声明</span></span>
<span data-line=""><span style="color:#6CB6FF">MultiProvider</span><span style="color:#ADBAC7">(</span></span>
<span data-line=""><span style="color:#ADBAC7">  providers</span><span style="color:#F47067">:</span><span style="color:#ADBAC7"> [</span></span>
<span data-line=""><span style="color:#6CB6FF">    Provider</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">AuthService</span><span style="color:#ADBAC7">&gt;(create</span><span style="color:#F47067">:</span><span style="color:#ADBAC7"> (_) </span><span style="color:#F47067">=&gt;</span><span style="color:#6CB6FF"> AuthService</span><span style="color:#ADBAC7">()),</span></span>
<span data-line=""><span style="color:#6CB6FF">    ProxyProvider</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">AuthService</span><span style="color:#ADBAC7">, </span><span style="color:#6CB6FF">TechnicianRepository</span><span style="color:#ADBAC7">&gt;...,</span></span>
<span data-line=""><span style="color:#6CB6FF">    ProxyProvider</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">TechnicianRepository</span><span style="color:#ADBAC7">, </span><span style="color:#6CB6FF">DispatchService</span><span style="color:#ADBAC7">&gt;...,</span></span>
<span data-line=""><span style="color:#6CB6FF">    ProxyProvider</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">DispatchService</span><span style="color:#ADBAC7">, </span><span style="color:#6CB6FF">OrderViewModel</span><span style="color:#ADBAC7">&gt;...,</span></span>
<span data-line=""><span style="color:#ADBAC7">    ...etc.</span></span>
<span data-line=""><span style="color:#ADBAC7">  ],</span></span>
<span data-line=""><span style="color:#ADBAC7">  child</span><span style="color:#F47067">:</span><span style="color:#F47067"> const</span><span style="color:#6CB6FF"> App</span><span style="color:#ADBAC7">()</span></span>
<span data-line=""><span style="color:#ADBAC7">)</span></span></code></pre></figure>
<p>每次新增服务类型都需要修改这个庞大的依赖树</p>
<ol start="2">
<li>类型安全缺失</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#ADBAC7">context.</span><span style="color:#DCBDFB">read</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">OrderModel</span><span style="color:#ADBAC7">&gt;().</span><span style="color:#DCBDFB">assignTechnician</span><span style="color:#ADBAC7">(patientInfo); </span><span style="color:#768390">// 运行时崩溃</span></span>
<span data-line=""><span style="color:#768390">// 本应传入TechnicianModel却误传PatientModel</span></span></code></pre></figure>
<ol start="3">
<li>状态同步延迟</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">class</span><span style="color:#6CB6FF"> OrderViewModel</span><span style="color:#F47067"> extends</span><span style="color:#6CB6FF"> ChangeNotifier</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#6CB6FF">  Future</span><span style="color:#ADBAC7">&lt;</span><span style="color:#F47067">void</span><span style="color:#ADBAC7">&gt; </span><span style="color:#DCBDFB">refreshOrders</span><span style="color:#ADBAC7">() </span><span style="color:#F47067">async</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#ADBAC7">    _orders </span><span style="color:#F47067">=</span><span style="color:#F47067"> await</span><span style="color:#ADBAC7"> repo.</span><span style="color:#DCBDFB">fetchEmergencyOrders</span><span style="color:#ADBAC7">();</span></span>
<span data-line=""><span style="color:#DCBDFB">    notifyListeners</span><span style="color:#ADBAC7">(); </span><span style="color:#768390">// 需要手动触发</span></span>
<span data-line=""><span style="color:#ADBAC7">  }</span></span>
<span data-line=""><span style="color:#ADBAC7">}</span></span></code></pre></figure>
<p>技师端和派单员的视图状态经常不一致，导致重复派单。</p>
<ol start="4">
<li>缓存策略缺失</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">class</span><span style="color:#6CB6FF"> CaseRepository</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#6CB6FF">  Future</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">CaseDetail</span><span style="color:#ADBAC7">&gt; </span><span style="color:#DCBDFB">getCase</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">String</span><span style="color:#ADBAC7"> id) </span><span style="color:#F47067">async</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#768390">    // 每次都重新请求</span></span>
<span data-line=""><span style="color:#F47067">    return</span><span style="color:#ADBAC7"> api.</span><span style="color:#DCBDFB">get</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&#x27;/cases/</span><span style="color:#ADBAC7">$</span><span style="color:#6CB6FF">id</span><span style="color:#96D0FF">&#x27;</span><span style="color:#ADBAC7">);</span></span>
<span data-line=""><span style="color:#ADBAC7">  }</span></span>
<span data-line=""><span style="color:#ADBAC7">}</span></span></code></pre></figure>
<h3>为什么选择Riverpod</h3>
<p>新的方案必须满足:</p>
<ul>
<li>automatic dependency injection</li>
<li>type checking in compile time</li>
<li>declarative without boilerplate and life cycle management</li>
<li>mechanism to cache data and invalidation</li>
</ul>
<p>Riverpod完美匹配这些需求：</p>
<ol>
<li>自动依赖图谱</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">final</span><span style="color:#ADBAC7"> technicianProvider </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> FutureProvider</span><span style="color:#ADBAC7">((ref) </span><span style="color:#F47067">async</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> ref.</span><span style="color:#DCBDFB">watch</span><span style="color:#ADBAC7">(authProvider).</span><span style="color:#DCBDFB">requireRole</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&#x27;technician&#x27;</span><span style="color:#ADBAC7">);</span></span>
<span data-line=""><span style="color:#ADBAC7">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#F47067">final</span><span style="color:#ADBAC7"> dispatchProvider </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> StateNotifierProvider</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">DispatchNotifier</span><span style="color:#ADBAC7">, </span><span style="color:#6CB6FF">DispatchState</span><span style="color:#ADBAC7">&gt;((ref) {</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#6CB6FF"> DispatchNotifier</span><span style="color:#ADBAC7">(ref.</span><span style="color:#DCBDFB">watch</span><span style="color:#ADBAC7">(technicianProvider));</span></span>
<span data-line=""><span style="color:#ADBAC7">});</span></span></code></pre></figure>
<ol start="2">
<li>编译时安全</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#ADBAC7">ref.</span><span style="color:#DCBDFB">read</span><span style="color:#ADBAC7">(orderProvider.notifier).</span><span style="color:#DCBDFB">assignCase</span><span style="color:#ADBAC7">(technician);</span></span>
<span data-line=""><span style="color:#768390">// 如果technician类型不匹配，IDE立即报错</span></span></code></pre></figure>
<ol start="3">
<li>响应式状态</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">@riverpod</span></span>
<span data-line=""><span style="color:#F47067">class</span><span style="color:#6CB6FF"> OrderTracking</span><span style="color:#F47067"> extends</span><span style="color:#6CB6FF"> _$OrderTracking</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#F47067">  @override</span></span>
<span data-line=""><span style="color:#6CB6FF">  Stream</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">OrderStatus</span><span style="color:#ADBAC7">&gt; </span><span style="color:#DCBDFB">build</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">String</span><span style="color:#ADBAC7"> orderId) {</span></span>
<span data-line=""><span style="color:#F47067">    return</span><span style="color:#ADBAC7"> ref.</span><span style="color:#DCBDFB">watch</span><span style="color:#ADBAC7">(orderRepoProvider).</span><span style="color:#DCBDFB">subscribeToUpdates</span><span style="color:#ADBAC7">(orderId);</span></span>
<span data-line=""><span style="color:#ADBAC7">  }</span></span>
<span data-line=""><span style="color:#ADBAC7">}</span></span></code></pre></figure>
<ol start="4">
<li>内置缓存</li>
</ol>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="dart" data-theme="github-dark-dimmed"><code data-language="dart" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">@riverpod</span></span>
<span data-line=""><span style="color:#6CB6FF">Future</span><span style="color:#ADBAC7">&lt;</span><span style="color:#6CB6FF">CaseDetail</span><span style="color:#ADBAC7">&gt; </span><span style="color:#DCBDFB">caseDetail</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">CaseDetailRef</span><span style="color:#ADBAC7"> ref, </span><span style="color:#6CB6FF">String</span><span style="color:#ADBAC7"> caseId) </span><span style="color:#F47067">async</span><span style="color:#ADBAC7"> {</span></span>
<span data-line=""><span style="color:#768390">  // 自动缓存病例数据</span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> ref.</span><span style="color:#DCBDFB">watch</span><span style="color:#ADBAC7">(caseRepoProvider).</span><span style="color:#DCBDFB">getDetail</span><span style="color:#ADBAC7">(caseId);</span></span>
<span data-line=""><span style="color:#ADBAC7">}</span></span></code></pre></figure>
<h3>总结</h3>
<p>从手动依赖注入, bulky dependencies declaration -&gt; 依赖关系自动管理 离散的状态定义</p>
<ul>
<li>开发体验好：新增功能不再需要到处手动注册依赖、思考 provider 的生命周期。</li>
<li>模块边界更清晰：Riverpod 的 provider 是声明即依赖</li>
<li>状态的表达更具语义性：每一个状态 provider 就像是一个逻辑单元，天然具有响应式和生命周期意识。</li>
<li>减少 bug 与调试时间：编译期的类型检查和依赖追踪让我们更快发现问题</li>
</ul></article><footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700"><div class="flex justify-between items-center"><a class="text-sm text-gray-600 dark:text-gray-400 hover:text-pink-900 dark:hover:text-pink-100 transition-colors" href="/blog">← 返回博客列表</a><div class="flex items-center gap-2"><span class="text-sm text-gray-500 dark:text-gray-500">标签:</span><div class="flex gap-1"><span class="text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded">Flutter</span><span class="text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded">Riverpod</span><span class="text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded">Provider</span></div></div></div></footer></article></div></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-5788873a3947c2cc.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n5:I[9665,[],\"MetadataBoundary\"]\n7:I[9665,[],\"OutletBoundary\"]\na:I[4911,[],\"AsyncMetadataOutlet\"]\nc:I[9665,[],\"ViewportBoundary\"]\ne:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/7833d2e2b2ee9543-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/f30152c0704fba31.css\",\"style\"]\n:HL[\"/_next/static/css/2afc3194b07f38f2.css\",\"style\"]\n:HL[\"/_next/static/css/a4098ded0e6557f6.css\",\"style\"]\n:HL[\"/_next/static/css/0e4ee5feb628e00d.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Iq6SCoEoTGz5WWuDlhU7j\",\"p\":\"\",\"c\":[\"\",\"blog\",\"riverpod0\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"riverpod0\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f30152c0704fba31.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2afc3194b07f38f2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a4098ded0e6557f6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_5e6612 __variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"riverpod0\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",[\"$\",\"$L5\",null,{\"children\":\"$L6\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0e4ee5feb628e00d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"Ib29iRzuarEUGGk-GNRzH\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:\"$Sreact.suspense\"\n10:I[4911,[],\"AsyncMetadata\"]\n6:[\"$\",\"$f\",null,{\"fallback\":null,\"children\":[\"$\",\"$L10\",null,{\"promise\":\"$@11\"}]}]\n"])</script><script>self.__next_f.push([1,"12:I[3565,[\"874\",\"static/chunks/874-36030fac62063c21.js\",\"63\",\"static/chunks/63-5ad18c88ec2f5164.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-ca6c25fdf74e0262.js\"],\"ImageWithFallback\"]\n14:I[6874,[\"874\",\"static/chunks/874-36030fac62063c21.js\",\"63\",\"static/chunks/63-5ad18c88ec2f5164.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-ca6c25fdf74e0262.js\"],\"\"]\n9:null\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background text-foreground\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto px-4 py-12\",\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"relative w-full h-64 md:h-96 mb-8 rounded-lg overflow-hidden\",\"children\":[\"$\",\"$L12\",null,{\"src\":\"/state_management_migration.jpg\",\"alt\":\"从Provider到Riverpod\",\"fill\":true,\"sizes\":\"width: 100vw; height: auto\",\"className\":\"object-cover\",\"priority\":true,\"fallbackSrc\":\"/missing-image.svg\"}]}],[\"$\",\"header\",null,{\"className\":\"mb-12\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2 mb-6\",\"children\":[[\"$\",\"span\",\"Flutter\",{\"className\":\"text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg\",\"children\":\"Flutter\"}],[\"$\",\"span\",\"Riverpod\",{\"className\":\"text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg\",\"children\":\"Riverpod\"}],[\"$\",\"span\",\"Provider\",{\"className\":\"text-xs px-3 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded-lg\",\"children\":\"Provider\"}]]}],[\"$\",\"h1\",null,{\"className\":\"text-2xl md:text-4xl text-gray-900 dark:text-gray-100 mb-6 leading-tight\",\"children\":\"从Provider到Riverpod\"}],[\"$\",\"p\",null,{\"className\":\"font-light text-md text-gray-600 dark:text-gray-400 leading-relaxed mb-6 italic\",\"children\":\"Bulky dependencies declaration VS Automatically managed Sparse dependency injection\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center text-sm text-gray-500 dark:text-gray-500\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"$D2024-11-28T00:00:00.000Z\",\"children\":\"2024年11月28日\"}]}],[\"$\",\"div\",null,{\"className\":\"w-16 h-px bg-gray-300 dark:bg-gray-600 mt-8\"}]]}],[\"$\",\"article\",null,{\"className\":\"max-w-none prose prose-pink prose-img:rounded-lg prose-video:rounded-lg dark:prose-invert prose-a:text-foreground prose-a:decoration-6 prose-a:-underline-offset-2 prose-a:decoration-pink-300\",\"children\":\"$L13\"}],[\"$\",\"footer\",null,{\"className\":\"mt-16 pt-8 border-t border-gray-200 dark:border-gray-700\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-between items-center\",\"children\":[[\"$\",\"$L14\",null,{\"href\":\"/blog\",\"className\":\"text-sm text-gray-600 dark:text-gray-400 hover:text-pink-900 dark:hover:text-pink-100 transition-colors\",\"children\":\"← 返回博客列表\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-sm text-gray-500 dark:text-gray-500\",\"children\":\"标签:\"}],[\"$\",\"div\",null,{\"className\":\"flex gap-1\",\"children\":[[\"$\",\"span\",\"Flutter\",{\"className\":\"text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded\",\"children\":\"Flutter\"}],[\"$\",\"span\",\"Riverpod\",{\"className\":\"text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded\",\"children\":\"Riverpod\"}],[\"$\",\"span\",\"Provider\",{\"className\":\"text-xs px-2 py-1 bg-pink-100 dark:bg-pink-800 text-pink-600 dark:text-pink-400 rounded\",\"children\":\"Provider\"}]]}]]}]]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"11:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"从Provider到Riverpod | 格物致知\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Bulky dependencies declaration VS Automatically managed Sparse dependency injection\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"Provider迁移,Riverpod优势,Flutter架构\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"从Provider到Riverpod\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Bulky dependencies declaration VS Automatically managed Sparse dependency injection\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/state_management_migration.jpg\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:alt\",\"content\":\"从Provider到Riverpod\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"8\",{\"property\":\"article:published_time\",\"content\":\"Thu Nov 28 2024 00:00:00 GMT+0000 (Coordinated Universal Time)\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"从Provider到Riverpod\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"Bulky dependencies declaration VS Automatically managed Sparse dependency injection\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/state_management_migration.jpg\"}]],\"error\":null,\"digest\":\"$undefined\"}\nb:{\"metadata\":\"$11:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"h3\",null,{\"children\":\"缘起：当Provider成为瓶颈\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1. 手工依赖地狱\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"// 订单模块的依赖声明\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"MultiProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  providers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"    Provider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"AuthService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e(create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (_) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" AuthService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"()),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"    ProxyProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"AuthService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"TechnicianRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e...,\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"    ProxyProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"TechnicianRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"DispatchService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e...,\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"    ProxyProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"DispatchService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"OrderViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e...,\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    ...etc.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  ],\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  child\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" App\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\")\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"每次新增服务类型都需要修改这个庞大的依赖树\"}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"类型安全缺失\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"read\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"OrderModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"assignTechnician\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(patientInfo); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"// 运行时崩溃\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"// 本应传入TechnicianModel却误传PatientModel\"}]}]]}]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"3\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"状态同步延迟\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" OrderViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" extends\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" ChangeNotifier\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"  Future\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"refreshOrders\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    _orders \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" repo.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"fetchEmergencyOrders\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"    notifyListeners\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"// 需要手动触发\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"技师端和派单员的视图状态经常不一致，导致重复派单。\"}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"4\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"缓存策略缺失\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" CaseRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"  Future\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"CaseDetail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"getCase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" id) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"    // 每次都重新请求\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" api.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"'/cases/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"为什么选择Riverpod\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"新的方案必须满足:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"automatic dependency injection\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"type checking in compile time\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"declarative without boilerplate and life cycle management\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"mechanism to cache data and invalidation\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Riverpod完美匹配这些需求：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"自动依赖图谱\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"final\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" technicianProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" FutureProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"((ref) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" ref.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"watch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(authProvider).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"requireRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"'technician'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"final\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" dispatchProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" StateNotifierProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"DispatchNotifier\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"DispatchState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e((ref) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" DispatchNotifier\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(ref.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"watch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(technicianProvider));\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"});\"}]}]]}]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"编译时安全\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"ref.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"read\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(orderProvider.notifier).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"assignCase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(technician);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"// 如果technician类型不匹配，IDE立即报错\"}]}]]}]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"3\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"响应式状态\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"@riverpod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" OrderTracking\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" extends\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" _$OrderTracking\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  @override\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"  Stream\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"OrderStatus\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"build\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" orderId) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" ref.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"watch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(orderRepoProvider).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"subscribeToUpdates\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(orderId);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"ol\",null,{\"start\":\"4\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"内置缓存\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"dart\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"@riverpod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"Future\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"CaseDetail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"caseDetail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"CaseDetailRef\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" ref, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" caseId) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"  // 自动缓存病例数据\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" ref.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"watch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(caseRepoProvider).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"getDetail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(caseId);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"总结\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"从手动依赖注入, bulky dependencies declaration -\u003e 依赖关系自动管理 离散的状态定义\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"开发体验好：新增功能不再需要到处手动注册依赖、思考 provider 的生命周期。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"模块边界更清晰：Riverpod 的 provider 是声明即依赖\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"状态的表达更具语义性：每一个状态 provider 就像是一个逻辑单元，天然具有响应式和生命周期意识。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"减少 bug 与调试时间：编译期的类型检查和依赖追踪让我们更快发现问题\"}],\"\\n\"]}]]\n"])</script></body></html>